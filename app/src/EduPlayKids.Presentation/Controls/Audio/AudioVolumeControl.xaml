<?xml version="1.0" encoding="utf-8" ?>
<ContentView xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="EduPlayKids.App.Controls.Audio.AudioVolumeControl"
             x:Name="this">

    <ContentView.Resources>
        <ResourceDictionary>
            <!-- Volume Slider Style -->
            <Style x:Key="VolumeSliderStyle" TargetType="Slider">
                <Setter Property="MinimumTrackColor" Value="#4CAF50" />
                <Setter Property="MaximumTrackColor" Value="#E0E0E0" />
                <Setter Property="ThumbColor" Value="#2196F3" />
                <Setter Property="HeightRequest" Value="40" />
                <Setter Property="Minimum" Value="0" />
                <Setter Property="Maximum" Value="1" />
            </Style>

            <!-- Volume Icon Style -->
            <Style x:Key="VolumeIconStyle" TargetType="Label">
                <Setter Property="FontSize" Value="24" />
                <Setter Property="TextColor" Value="#333333" />
                <Setter Property="HorizontalOptions" Value="Center" />
                <Setter Property="VerticalOptions" Value="Center" />
                <Setter Property="FontFamily" Value="FontAwesome" />
            </Style>

            <!-- Mute Button Style -->
            <Style x:Key="MuteButtonStyle" TargetType="Button">
                <Setter Property="BackgroundColor" Value="Transparent" />
                <Setter Property="BorderColor" Value="#E0E0E0" />
                <Setter Property="BorderWidth" Value="2" />
                <Setter Property="CornerRadius" Value="20" />
                <Setter Property="WidthRequest" Value="40" />
                <Setter Property="HeightRequest" Value="40" />
                <Setter Property="FontSize" Value="16" />
                <Setter Property="TextColor" Value="#333333" />
            </Style>

            <!-- Audio Type Label Style -->
            <Style x:Key="AudioTypeLabelStyle" TargetType="Label">
                <Setter Property="FontSize" Value="14" />
                <Setter Property="FontAttributes" Value="Bold" />
                <Setter Property="TextColor" Value="#333333" />
                <Setter Property="HorizontalOptions" Value="Start" />
                <Setter Property="VerticalOptions" Value="Center" />
            </Style>

            <!-- Volume Percentage Style -->
            <Style x:Key="VolumePercentageStyle" TargetType="Label">
                <Setter Property="FontSize" Value="12" />
                <Setter Property="TextColor" Value="#666666" />
                <Setter Property="HorizontalOptions" Value="End" />
                <Setter Property="VerticalOptions" Value="Center" />
                <Setter Property="WidthRequest" Value="40" />
            </Style>
        </ResourceDictionary>
    </ContentView.Resources>

    <Border BackgroundColor="White"
            Stroke="#E0E0E0"
            StrokeThickness="1"
            StrokeShape="RoundRectangle 10"
            Padding="15"
            Margin="5">

        <Grid RowDefinitions="Auto,*,Auto" RowSpacing="10">

            <!-- Header Row -->
            <Grid Grid.Row="0" ColumnDefinitions="*,Auto">
                <Label Grid.Column="0"
                       Text="{Binding Source={x:Reference this}, Path=AudioTypeDisplayName}"
                       Style="{StaticResource AudioTypeLabelStyle}" />

                <Label Grid.Column="1"
                       Text="{Binding Source={x:Reference this}, Path=VolumePercentageText}"
                       Style="{StaticResource VolumePercentageStyle}" />
            </Grid>

            <!-- Volume Control Row -->
            <Grid Grid.Row="1" ColumnDefinitions="Auto,*,Auto" ColumnSpacing="10">

                <!-- Volume Low Icon -->
                <Button Grid.Column="0"
                        Text="ðŸ”‰"
                        Style="{StaticResource MuteButtonStyle}"
                        Command="{Binding Source={x:Reference this}, Path=SetLowVolumeCommand}"
                        IsVisible="{Binding Source={x:Reference this}, Path=ShowVolumeIcons}" />

                <!-- Volume Slider -->
                <Slider Grid.Column="1"
                        x:Name="VolumeSlider"
                        Value="{Binding Source={x:Reference this}, Path=VolumeLevel, Mode=TwoWay}"
                        Style="{StaticResource VolumeSliderStyle}"
                        ValueChanged="OnVolumeChanged"
                        DragCompleted="OnVolumeDragCompleted" />

                <!-- Volume High Icon -->
                <Button Grid.Column="2"
                        Text="ðŸ”Š"
                        Style="{StaticResource MuteButtonStyle}"
                        Command="{Binding Source={x:Reference this}, Path=SetHighVolumeCommand}"
                        IsVisible="{Binding Source={x:Reference this}, Path=ShowVolumeIcons}" />

            </Grid>

            <!-- Control Buttons Row -->
            <Grid Grid.Row="2" ColumnDefinitions="*,*,*" ColumnSpacing="10"
                  IsVisible="{Binding Source={x:Reference this}, Path=ShowControlButtons}">

                <!-- Mute Button -->
                <Button Grid.Column="0"
                        Text="{Binding Source={x:Reference this}, Path=MuteButtonText}"
                        Command="{Binding Source={x:Reference this}, Path=ToggleMuteCommand}"
                        Style="{StaticResource MuteButtonStyle}"
                        BackgroundColor="{Binding Source={x:Reference this}, Path=MuteButtonColor}" />

                <!-- Test Audio Button -->
                <Button Grid.Column="1"
                        Text="ðŸŽµ Test"
                        Command="{Binding Source={x:Reference this}, Path=TestAudioCommand}"
                        Style="{StaticResource MuteButtonStyle}"
                        IsEnabled="{Binding Source={x:Reference this}, Path=CanTestAudio}" />

                <!-- Reset Button -->
                <Button Grid.Column="2"
                        Text="Reset"
                        Command="{Binding Source={x:Reference this}, Path=ResetVolumeCommand}"
                        Style="{StaticResource MuteButtonStyle}"
                        IsVisible="{Binding Source={x:Reference this}, Path=ShowResetButton}" />

            </Grid>

        </Grid>

        <!-- Volume Change Visual State (simplified for MAUI) -->
        <VisualStateManager.VisualStateGroups>
            <VisualStateGroup Name="VolumeStates">
                <VisualState Name="VolumeChanging">
                    <VisualState.Setters>
                        <Setter Property="Scale" Value="1.05" />
                    </VisualState.Setters>
                </VisualState>
                <VisualState Name="Normal">
                    <VisualState.Setters>
                        <Setter Property="Scale" Value="1.0" />
                    </VisualState.Setters>
                </VisualState>
            </VisualStateGroup>
        </VisualStateManager.VisualStateGroups>

    </Border>

</ContentView>